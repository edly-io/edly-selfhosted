const { Popover } = await import('@typeform/embed-react');
const { getAuthenticatedHttpClient } = await import('@edx/frontend-platform/auth');
const { useState, useEffect } = await import ('react');


const OnboardingSurvey = () => {
  const [showForm, setShowForm] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    const apiUrl = `${getConfig().LMS_BASE_URL}/api/onboarding-survey/`;


    const handleOnReady = () => {
      const updateOnboardingFormStatus = async () => {
        try {
          const response = await getAuthenticatedHttpClient().post(apiUrl, {
            form_filled: true
          })
        } catch (error) {
          console.log(error);
        }
      }

      updateOnboardingFormStatus();
    }

    useEffect(() => {
        const fetchData = async () => {
            try {
                const response = await getAuthenticatedHttpClient().get(apiUrl);
                setShowForm(response.data.show_form);
            } catch (err) {
                console.error('API error:', err);
                setError('Failed to load data'); 
                setShowForm(false); 
            } finally {
                setLoading(false);
            }
        };

        fetchData();
    }, []);

    if (loading) return <></>;
    if (error) return <></>;

    return showForm ? <Popover id="WHBX8vDV" height="80vh" onReady={handleOnReady}/> : <></>;
}